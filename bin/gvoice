#!/usr/bin/env python
import sys
from optparse import OptionParser
from googlevoice import Voice,LoginError

parser = OptionParser()
parser.add_option("-e", "--email", dest="email", default=None,
                  help="Google Voice Account Email")
parser.add_option("-p", "--password", dest='passwd', default=None,
                  help='Your account password (prompted for if blank)')
parser.add_option("-v", "--verbose",
                  action="store_true", dest="v", default=False,
                  help="Print status messages")

(options, args) = parser.parse_args()


voice = Voice()

def login(email=options.email,passwd=options.passwd):
    try:
        voice.login(options.email,options.passwd)
    except LoginError:
        if raw_input('Login failed. Retry?[Y/n] ').lower() in ('','y'):
            login(None,None)
        sys.exit(0)
try:
    login()
except KeyboardInterrupt:
    sys.exit(0)
    

try:
    action,args = args[0],args[1:]
except IndexError:
    action = 'interactive'

if action == 'interactive':
    while 1:
        
        action = raw_input()
else:
    getattr(voice,action)(*args)
